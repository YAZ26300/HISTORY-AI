-- Fonction SQL Ã  ajouter dans la console Supabase
CREATE OR REPLACE FUNCTION allow_authenticated_uploads(bucket_name text) RETURNS void LANGUAGE plpgsql SECURITY DEFINER AS $$ BEGIN EXECUTE format('CREATE POLICY allow_authenticated_uploads ON storage.objects FOR INSERT TO authenticated USING (bucket_id = %L);', bucket_name); EXECUTE format('CREATE POLICY allow_authenticated_read ON storage.objects FOR SELECT TO authenticated USING (bucket_id = %L AND auth.uid() = owner);', bucket_name); EXECUTE format('CREATE POLICY allow_authenticated_delete ON storage.objects FOR DELETE TO authenticated USING (bucket_id = %L AND auth.uid() = owner);', bucket_name); END; $$;
